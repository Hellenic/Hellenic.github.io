"use strict";angular.module("NatureQuizApp",["ngCookies","ngResource","ngSanitize","ngAnimate","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$tooltipProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.setTriggers({answerAttempt:"answerAttemptClose"})}]),angular.module("NatureQuizApp").controller("CategoryCtrl",["$scope","$stateParams","$timeout","$modal","categoryService","progressService","categoryPopulator","looseAnswerValidator",function(a,b,c,d,e,f,g,h){var i=e.getCategory(b.categoryId);i.then(function(b){a.category=g.populateCategory(b),a.formClass=""}),a.next=function(){a.formClass="",a.answerInput="";var b=a.findCarouselScope(a);b.next();var c=a.findActiveLevel();f.setActiveLevel(a.category,c.id)},a.prev=function(){a.formClass="",a.answerInput="";var b=a.findCarouselScope(a);b.prev();var c=a.findActiveLevel();f.setActiveLevel(a.category,c.id)},a.select=function(b){a.formClass="",a.answerInput="";var c=a.findCarouselScope(a);c.select(b);var d=a.findActiveLevel();f.setActiveLevel(a.category,d.id)},a.isCompleted=function(b){var c=a.findCarouselScope(a),d=c.slides.indexOf(b),e=a.category.levels[d];return f.isLevelCompleted(a.category,e)},a.openLevelModal=function(b,c){var e=d.open({animation:!0,templateUrl:"template/modal/levelModalContent.html",controller:"ModalInstanceCtrl",resolve:{level:function(){return c},category:function(){return b}}});e.result.then(function(){a.next()})},a.answer=function(){a.answerAttemptPopover(!1);var b=a.findActiveLevel(),c=this.answerInput,d=h.validate(b,c);d?(a.formClass="has-success",a.openLevelModal(a.category,b),f.completeLevel(a.category,b),this.answerInput=""):a.answerAttemptPopover(!0)},a.answerAttemptPopover=function(b){b?c(function(){$("#answer-input").trigger("answerAttempt"),a.formClass="has-warning"},0):c(function(){$("#answer-input").trigger("answerAttemptClose"),a.formClass=""},0)},a.findActiveLevel=function(){var b=a.findActiveIndex();return 0>b?null:a.category.levels[b]},a.findActiveIndex=function(){for(var b=a.findCarouselScope(a),c=0;c<b.slides.length;c++){var d=b.slides[c];if(d.active)return c}return-1},a.findCarouselScope=function(a){for(var b=a.$$childHead;b;b=b.$$nextSibling)if(null!==b&&null!==b.$$childHead&&b.$$childHead.hasOwnProperty("slides"))return b.$$childHead;return null}}]),angular.module("NatureQuizApp").config(["$stateProvider",function(a){a.state("category",{url:"/categories/:categoryId",templateUrl:"app/category/category.html",controller:"CategoryCtrl"})}]),angular.module("NatureQuizApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","level","category",function(a,b,c,d){a.level=c,a.category=d,a.close=function(){b.close()}}]),angular.module("NatureQuizApp").controller("HelpCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("NatureQuizApp").config(["$stateProvider",function(a){a.state("help",{url:"/help",templateUrl:"app/help/help.html",controller:"HelpCtrl"})}]),angular.module("NatureQuizApp").controller("MainCtrl",["$scope","categoryService","categoryPopulator",function(a,b,c){a.categories=[];var d=b.getCategories();d.then(function(b){a.categories=c.populateCategories(b)},function(a){console.log("TODO Loading of categories failed...",a)},function(b){a.categories=c.populateCategories(b)})}]),angular.module("NatureQuizApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("NatureQuizApp").service("categoryPopulator",["progressService",function(a){this.populateCategories=function(a){for(var b=0;b<a.length;b++)a[b]=this.populateCategory(a[b]);return a},this.populateCategory=function(b){var c=a.getCategoryProgress(b.id),d=b.levelCount||b.levels.length,e=Math.floor(c.completedLevelIds.length/d*100);return b.progressPercent=e,b}}]),angular.module("NatureQuizApp").service("androidResourceService",["$q","$resource",function(a,b){this.getTranslations=function(c,d){var e=a.defer(),f=this;return b("assets/localization/:locale/:file.json",{locale:d,file:c}).get(function(a){var b=a.resources.string,c=a.resources["string-array"],d=f.transformStrings(b),g=f.transformStringArrays(c),h={string:d,stringArray:g};e.resolve(h)}),e.promise},this.transformStrings=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++){var d=a[c].name,e=a[c]._;b[d]=e}return b},this.transformStringArrays=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++){var d=a[c].name,e=a[c].item;e instanceof Array||(e=[e]),b[d]=e}return b}}]),angular.module("NatureQuizApp").service("categoryService",["$q","$resource","$stateParams","l10nService",function(a,b,c,d){this.getCategory=function(e){var f=a.defer();return b("assets/categories/:categoryId.json",{categoryId:e}).get(function(a){var b=a.category;b.id=c.categoryId,b.levels=b.levels.level;var e=d.translate(b.id,b);e.then(function(a){f.resolve(a)})}),f.promise},this.getCategories=function(){var c=a.defer();return b("assets/categories/:categoryId.json",{categoryId:"categories",isArray:!0}).query(function(a){for(var b=[],e=0;e<a.length;e++){var f=a[e],g=d.translate(f.id,f);g.then(function(d){b.push(d),c.notify(b),b.length===a.length&&c.resolve(b)})}}),c.promise}}]),angular.module("NatureQuizApp").service("l10nService",["$q","$resource","androidResourceService","localeService",function(a,b,c,d){this.translate=function(b,e){var f=a.defer(),g=this,h=c.getTranslations(b,d.getLocale());return h.then(function(a){var b=g.translateObject(a,e);f.resolve(b)}),f.promise},this.translateObject=function(a,b){for(var c in b){var d=b[c];if("string"==typeof d&&d.indexOf("/")>0){var e=d.split("/")[0],f=d.split("/")[1],g=null;"@string"===e?g=a.string[f]:"@array"===e?g=a.stringArray[f]:console.warn("Unknown object type, unable to translate!",e),b[c]=g}else"object"==typeof d&&this.translateObject(a,d)}return b}}]),angular.module("NatureQuizApp").service("localeService",["storageService",function(a){var b="quiz-locale";this.getDefaultLocale=function(){return"en"},this.getLocale=function(){var c=a.load(b);return Boolean(c)||(c=this.getDefaultLocale(),this.setLocale(c)),c},this.setLocale=function(c){a.save(b,c)}}]),angular.module("NatureQuizApp").service("progressService",["storageService",function(a){var b="quiz-progress";this.setProgress=function(c){a.save(b,c)},this.getProgress=function(){var c=a.load(b);return Boolean(c)||(c={},this.setProgress(c)),c},this.initCategoryProgress=function(){return{activeLevelId:1,completedLevelIds:[]}},this.setCategoryProgress=function(a,b){var c=this.getProgress();c[a]=b,this.setProgress(c)},this.getCategoryProgress=function(a){var b=this.getProgress();return b.hasOwnProperty(a)||(b[a]=this.initCategoryProgress(),this.setProgress(b)),b[a]},this.setActiveLevel=function(a,b){var c=this.getCategoryProgress(a.id);c.activeLevelId=b,this.setCategoryProgress(a.id,c)},this.getActiveLevel=function(a){for(var b=this.getCategoryProgress(a.id),c=0;c<a.levels.length;c++){var d=a.levels[c];if(b.activeLevelId===d.id)return d}return null},this.completeLevel=function(a,b){var c=this.getCategoryProgress(a.id);c.completedLevelIds.push(b.id),this.setCategoryProgress(a.id,c)},this.isLevelCompleted=function(a,b){var c=this.getCategoryProgress(a.id);return c.completedLevelIds.indexOf(b.id)>=0}}]),angular.module("NatureQuizApp").service("settingsService",["storageService","localeService",function(a,b){var c="quiz-settings";this.getSettings=function(){var d=a.load(c);return Boolean(d)||(d={locale:b.getLocale()},this.setSettings(d)),d},this.setSettings=function(d){a.save(c,d),b.setLocale(d.locale)}}]),angular.module("NatureQuizApp").service("storageService",function(){this.save=function(a,b){var c=JSON.stringify(b);localStorage.setItem(a,c)},this.load=function(a){var b=localStorage.getItem(a);return JSON.parse(b)}}),angular.module("NatureQuizApp").controller("SettingsCtrl",["$scope","settingsService","$state",function(a,b,c){a.locale=b.getSettings().locale,a.$watch("locale",function(a,d){if(a!==d){var e=b.getSettings();e.locale=a,b.setSettings(e),c.reload()}}),a.reset=function(){localStorage.clear(),a.locale=b.getSettings().locale}}]),angular.module("NatureQuizApp").config(["$stateProvider",function(a){a.state("settings",{url:"/settings",templateUrl:"app/settings/settings.html",controller:"SettingsCtrl"})}]),angular.module("NatureQuizApp").service("looseAnswerValidator",function(){this.validate=function(a,b){if(!b)return!1;for(var c=b.trim().toLowerCase(),d=0;d<a.answers.length;d++){var e=a.answers[d];if(c===e)return!0}return!1}}),angular.module("NatureQuizApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("NatureQuizApp").controller("NavbarCtrl",["$scope","$location","$rootScope","$resource","localeService",function(a,b,c,d,e){var f=e.getLocale();d("assets/localization/:locale/:file.json",{locale:f,file:"localizations"}).get(function(a){c.loc=a}),a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("NatureQuizApp").run(["$templateCache",function(a){a.put("app/category/category.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><!-- style="background: #FFF url(\'assets/images/categories/{{category.image}}\') no-repeat;" --><header class=hero-unit id=banner><div class=container><h1>{{category.name}}</h1></div><div class=container ng-hide=categoryVisible><p class=lead>{{category.description}}</p><img src=assets/images/categories/{{category.image}} alt={{category.name}} style="width: 300px"><br><a href={{category.link}} class=hero-link>{{loc.quiz_read_more}}</a></div><div class=container><a href=# class="glyphicon hero-link" ng-class="{\'glyphicon-chevron-up\': !categoryVisible, \'glyphicon-chevron-down\': categoryVisible}" ng-click="categoryVisible = !categoryVisible">{{loc.nav_toggle}}</a></div></header><div class=container><div class=row><div class=col-lg-12><div ng-include="\'components/category/category.html\'"></div></div></div></div><div ng-include="\'components/footer/footer.html\'"></div>'),a.put("app/help/help.html","<div ng-include=\"'components/navbar/navbar.html'\"></div><div ng-include=\"'components/banner/main.html'\"></div><div class=container><div class=row><div class=col-lg-12><h1 class=page-header>{{loc.help_title}}</h1><p ng-bind-html=loc.help_description></p></div></div></div><div ng-include=\"'components/footer/footer.html'\"></div>"),a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div ng-include="\'components/banner/main.html\'"></div><div class=container><div class="alert alert-info" role=alert ng-bind-html=loc.quiz_development_note></div></div><div class=container><div class=row><div class=col-lg-12><h1 class="page-header text-center">{{loc.categories_title}}</h1><div ng-include="\'components/category/categoryview.html\'"></div></div></div></div><div ng-include="\'components/footer/footer.html\'"></div>'),a.put("app/settings/settings.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div ng-include="\'components/banner/main.html\'"></div><div class=container><div class=row><div class=col-lg-12><h1 class=page-header>{{loc.settings_text}}</h1><form><div class=form-group><label for=locale-select>{{loc.settings_language}}</label><select id=locale-select class=form-control ng-model=locale><option value=en>{{loc.settings_locale_en}}</option><option value=fi>{{loc.settings_locale_fi}}</option><option value=ru>{{loc.settings_locale_ru}}</option></select><small>For debugging purposes only.</small><br><button type=button class="btn btn-warning" ng-click=reset()>Reset settings</button></div></form></div></div></div><div ng-include="\'components/footer/footer.html\'"></div>'),a.put("components/banner/main.html","<header class=hero-unit id=banner><div class=container><h1>{{loc.app_header}}</h1><p class=lead>{{loc.quiz_description}}</p><img src=assets/images/naturequiz.png alt=NatureQuiz></div></header>"),a.put("components/category/category.html",'<script id=template/carousel/carousel.html type=text/ng-template><div class="carousel" ng-swipe-right="$parent.prev()" ng-swipe-left="$parent.next()">\n        <ol class="progress-indicators" ng-show="slides.length > 1">\n            <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index"\n                ng-class="{active: isActive(slide), completed: $parent.$parent.isCompleted(slide)}" \n                ng-click="$parent.$parent.select(slide)">\n            </li>\n        </ol>\n        <div class="carousel-inner" ng-transclude></div>\n        <a class="left carousel-control" ng-click="$parent.prev()" ng-show="slides.length > 1">\n            <span class="glyphicon glyphicon-chevron-left"></span>\n        </a>\n        <a class="right carousel-control" ng-click="$parent.next()" ng-show="slides.length > 1">\n            <span class="glyphicon glyphicon-chevron-right"></span>\n        </a>\n    </div></script><script id=template/modal/levelModalContent.html type=text/ng-template><div class="modal-header">\n        <h3 class="modal-title">{{level.name}} - {{loc.quiz_default_answer_text}}</h3>\n    </div>\n    <div class="modal-body">\n        <p>{{level.description}}</p>\n        <p>{{loc.quiz_facts}}\n        <ul>\n            <li ng-repeat="fact in level.facts">{{fact}}</li>\n        </ul>\n        </p>\n        <p><a href="{{level.link}}">{{loc.quiz_read_more}}</a></p>\n        <img ng-src="assets/images/categories/{{category.id}}/{{level.image}}" class="img-responsive" />\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-primary btn-block" type="button" ng-click="close()">OK</button>\n    </div></script><div><div><carousel interval=-1 no-wrap=false><slide ng-repeat="level in category.levels"><img ng-src=assets/images/categories/{{category.id}}/{{level.image}} style=margin:auto><div class=carousel-caption><p>{{level.hint}}</p></div></slide><form class="container level-answer-form" ng-submit=answer()><div class=form-group ng-class=formClass><input id=answer-input type=answer ng-model=answerInput name=answerInput class=form-control placeholder={{loc.quiz_answer_placeholder}} popover={{loc.quiz_default_incorrect_answer_text}} popover-placement=top popover-trigger=answerAttempt popover-animation="true"></div></form></carousel></div></div>'),a.put("components/category/categoryview.html",'<ul class="list-group col-md-offset-2 col-md-8 col-lg-8 col-sm-8" ng-repeat="category in categories | orderBy: \'name\'"><li class=list-group-item><h3>{{category.name}}</h3><p>{{category.description}}</p><div class=progress><div class="progress-bar progress-bar-success progress-bar-striped" role=progressbar aria-valuemin=0 aria-valuemax=100 aria-valuenow={{category.progressPercent}} style="width: {{category.progressPercent}}%">{{category.progressPercent}}%</div></div><a type=button class="btn btn-primary btn-lg btn-block" href=categories/{{category.id}}>{{loc.play_button}}</a></li></ul>'),a.put("components/footer/footer.html",'<footer class=footer><div class=container><p>{{loc.footer_version}} | <a href="http://blankpace.net/HK/">Hannu Kärkkäinen</a></p></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>{{loc.nav_toggle}}</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href=home class=navbar-brand>{{loc.app_header}}</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-class="{active: isActive(\'/\')}"><a ng-href=home>{{loc.nav_home}}</a></li><li ng-class="{active: isActive(\'help\')}"><a ng-href=help>{{loc.nav_help}}</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-class="{active: isActive(\'/settings\')}"><a href=settings><span class="glyphicon glyphicon-cog" aria-hidden=true></span></a></li></ul></div></div></div>')}]);